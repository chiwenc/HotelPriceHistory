{% extends "base.html" %}

{% block content %}

    <div class="container">
        <h1 class="mt-5">酒店追蹤需求</h1>
        <form action="{{url_for('auth.user_request')}}", method="post">
            <div class="form-group">
                <label for="hotel_name">酒店名稱:</label>
                <input type="text" class="form-control" name="hotel_name" required>
            </div>

            <div class="form-group">
                <label for="checkin_date">入住日期:</label>
                <input type="date" class="form-control" name="checkin_date" required>
            </div>

            <div class="form-group">
                <label for="checkout_date">退房日期:</label>
                <input type="date" class="form-control" name="checkout_date" required>
            </div>

            <button type="submit" class="btn btn-primary">提交</button>
        </form>

        <h2 class="mt-5">已追蹤的需求:</h2>
        <ul class="list-group">
            <ul class="list-group">
                {% for booking in bookings %}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between">
                            <div>
                                {{ booking.hotel_name }} - 入住日期: {{ booking.checkin_date }}, 退房日期: {{ booking.checkout_date }}
                            </div>
                            <div>
                                <!-- <button class="btn btn-primary btn-sm mr-2" onclick="redirectToDashboard('{{ booking.id }}')">Dashboard</button> -->
                                <button class="btn btn-danger btn-sm" onclick="deleteBooking('{{ booking.id }}')">删除</button>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>                
        </ul>
    </div>

    <script>
        function deleteBooking(bookingId) {
            if (confirm("確定刪除嗎？")) {
                fetch('/api/v1/user/delete_request/?request_id=' + encodeURIComponent(bookingId))
                .then(response => response.json())
                .then(data => {
                    // 显示成功删除的消息
                    alert(data.message);
                    // 刷新页面
                    location.reload();
                });
            }
        };
        // function redirectToDashboard(bookingId) {
        // window.location.href = `/api/dashboard?bookingId=${bookingId}`;
        // }
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

{% endblock %}
